# Alfa Forge Database Schema

## –û–±–∑–æ—Ä

–≠—Ç–∞ —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Alfa Forge - –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è, –≤–∫–ª—é—á–∞—é—â–µ–π —Ñ–∏—Ç–Ω–µ—Å, –ø—Ä–∏–≤—ã—á–∫–∏, —Ü–µ–ª–∏ –∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

### üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (users)
–•—Ä–∞–Ω–∏—Ç –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤–∫–ª—é—á–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞.

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
- `id` - UUID –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `email` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π email
- `username` - —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `full_name`, `phone`, `city` - –ø—Ä–æ—Ñ–∏–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `onboarding_completed` - —Å—Ç–∞—Ç—É—Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞

### üéØ –ü—Ä–∏–≤—ã—á–∫–∏ (habits, user_habits, habit_logs)
–°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–∏–≤—ã—á–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**habits** - —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–∏–≤—ã—á–µ–∫
**user_habits** - –ø—Ä–∏–≤—è–∑–∫–∞ –ø—Ä–∏–≤—ã—á–µ–∫ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
**habit_logs** - –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏–≤—ã—á–µ–∫

### üèÜ –¶–µ–ª–∏ (goals, goal_history)
–°–∏—Å—Ç–µ–º–∞ "6 –õ–µ—Å—Ç–Ω–∏—Ü –¶–µ–ª–µ–π" –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

**goals** - –æ—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**goal_history** - –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ —Ü–µ–ª—è–º

### üìä –ü—Ä–æ–≥—Ä–µ—Å—Å (user_progress, progress_history, sphere_progress)
–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–±—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**user_progress** - —Å—É–º–º–∞—Ä–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
**progress_history** - –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å
**sphere_progress** - –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Å—Ñ–µ—Ä–∞–º —Ä–∞–∑–≤–∏—Ç–∏—è

### üí™ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (exercises, workout_sessions, workout_exercises)
–°–∏—Å—Ç–µ–º–∞ —Ñ–∏—Ç–Ω–µ—Å–∞ –∏ GTO –Ω–æ—Ä–º–∞—Ç–∏–≤–æ–≤.

**exercises** - —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
**workout_sessions** - —Å–µ—Å—Å–∏–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
**workout_exercises** - —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ

### ‚úÖ –ó–∞–¥–∞—á–∏ (tasks)
–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ –∏ —Å—Ä–æ–∫–∞–º–∏.

### üë• –ë—Ä–∞—Ç—Å—Ç–≤–æ (brotherhood_posts, brotherhood_comments, brotherhood_likes)
–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **Row Level Security (RLS)** –≤–∫–ª—é—á–µ–Ω–∞ –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã

## –ò–Ω–¥–µ–∫—Å—ã

–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è:
- –ü–æ–∏—Å–∫–∞ –ø–æ email –∏ username
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –¥–∞—Ç–∞–º
- –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

## –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–ú–∏–≥—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç:
- 4 –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏
- 3 –±–∞–∑–æ–≤—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
- –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤

## –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ß–µ—Ä–µ–∑ Supabase CLI
supabase db push

# –ò–ª–∏ —á–µ—Ä–µ–∑ SQL —Ä–µ–¥–∞–∫—Ç–æ—Ä –≤ Supabase Dashboard
# –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ 20241002_initial_schema.sql
```

## –§–∞–π–ª—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

- `migrations/20241002_initial_schema.sql` - –æ—Å–Ω–æ–≤–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã
- `queries.sql` - –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- `types.ts` - TypeScript —Ç–∏–ø—ã –¥–ª—è Supabase –∫–ª–∏–µ–Ω—Ç–∞
- `README.md` - —ç—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Flutter

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∏–ø–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å types.ts –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
cp supabase/types.ts lib/types/supabase_types.dart
```

### 2. –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

```dart
import 'package:supabase_flutter/supabase_flutter.dart';

final supabase = Supabase.instance.client;

// –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
final userProfile = await supabase
  .from('users')
  .select()
  .eq('id', userId)
  .single();

// –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ü–µ–ª—å
await supabase.from('goals').insert({
  'user_id': userId,
  'name': '–ü—Ä–æ—á–∏—Ç–∞—Ç—å 12 –∫–Ω–∏–≥',
  'target_value': 12,
  'unit': '–∫–Ω–∏–≥',
  'goal_type': 'increase',
});

// –ó–∞–ø–∏—Å–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏
await supabase.from('habit_logs').insert({
  'user_habit_id': habitId,
  'user_id': userId,
  'logged_date': DateTime.now().toIso8601String().split('T')[0],
  'actual_value': 1,
});
```

## –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- `update_user_streak(user_uuid)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–∏–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–Ω–µ–π
- `calculate_goal_progress(goal_uuid)` - —Ä–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ —Ü–µ–ª–∏

## –°–ª–µ–¥—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- –ì—Ä—É–ø–ø–æ–≤—ã–µ –≤—ã–∑–æ–≤—ã
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã